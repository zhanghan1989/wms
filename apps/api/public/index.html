<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>库存管理系统</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="bg-shape bg-shape-a"></div>
  <div class="bg-shape bg-shape-b"></div>

  <section id="loginGate" class="login-gate">
    <article class="login-card">
      <div class="login-brand">
        <div class="brand-mark">W</div>
        <div>
          <p class="brand-title">库存管理系统</p>
          <p class="brand-sub">登录后进入仓库管理系统</p>
        </div>
      </div>
      <form id="loginGateForm" class="form-grid login-grid">
        <label>用户名<input id="gateUsername" value="admin" autocomplete="username" /></label>
        <label>密码<input id="gatePassword" type="password" value="Admin@123" autocomplete="current-password" /></label>
        <button type="submit">登录系统</button>
      </form>
    </article>
  </section>

  <header id="appTopbar" class="topbar hidden">
    <div class="brand">
      <div class="brand-mark">W</div>
      <div>
        <p class="brand-title">库存管理系统</p>
        <p class="brand-sub">Warehouse operations preview</p>
      </div>
    </div>
    <div class="session-wrap">
      <div class="session-main">
        <div class="session" id="sessionInfo">未登录</div>
        <button type="button" id="topLogoutBtn" class="ghost">登出</button>
      </div>
      <div class="session-actions hidden" id="employeeQuickActions">
        <button type="button" id="openInventoryHome">首页</button>
        <button type="button" id="openOverseasWarehousePanel">海外仓管理</button>
        <button type="button" id="openCreateShelfQuick">新增货架</button>
        <button type="button" id="openFbaReplenishmentPanel" class="btn-with-badge">
          FBA补货
          <span id="fbaPendingBadge" class="quick-badge hidden">0</span>
        </button>
        <button type="button" id="openBatchInboundModal">批量入库</button>
        <button type="button" id="openMyAuditLog" class="ghost">我的日志</button>
        <button type="button" id="openProfileModal" class="ghost">个人设置</button>
      </div>
    </div>
  </header>

  <main id="appLayout" class="layout hidden">
    <aside class="sidebar">
      <button class="nav-btn active" data-target="inventory">库存管理</button>
      <button class="nav-btn" data-target="overseasWarehouse">海外仓管理</button>
      <button class="nav-btn" data-target="fbaReplenishment">FBA补货</button>
      <button class="nav-btn" data-target="batchInbound">批量入库</button>
      <button class="nav-btn" data-target="overview">总览</button>
      <button class="nav-btn" data-target="users">员工</button>
      <button class="nav-btn" data-target="audit">操作日志</button>
    </aside>

    <section class="panel-wrap">
      <section class="panel active" id="inventory">
        <div class="panel-head">
          <h2>产品检索</h2>
          <button id="refreshInventory" class="ghost">刷新</button>
        </div>

        <div class="inventory-toolbar">
          <form id="inventorySearchForm" class="form-grid inventory-search-form">
            <label><input id="inventoryKeyword" placeholder="SKU/erpSKU/ASIN/FNSKU" /></label>
            <button type="submit">检索</button>
          </form>

          <div id="inventorySearchSection" class="card inventory-search-card hidden">
            <h3>检索结果</h3>
            <div id="inventorySearchResults" class="inventory-search-results">-</div>
          </div>
        </div>

        <div id="inventoryListSection">
          <table class="inventory-table">
            <thead>
              <tr>
                <th>型号</th>
                <th>说明1</th>
                <th>说明2</th>
                <th>备注</th>
                <th>SKU</th>
                <th>店铺</th>
                <th>在库数</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="inventoryBody"></tbody>
          </table>
        </div>
      </section>

      <section class="panel" id="overseasWarehouse">
        <div class="panel-head">
          <h2>海外仓管理</h2>
          <button id="refreshOverseasWarehouse" class="ghost">刷新</button>
        </div>

        <article class="card">
          <h3>基础操作</h3>
          <div class="action-row">
            <button type="button" id="openCreateSkuModal">新增产品</button>
            <button type="button" id="openCreateBoxQuick">新增箱号</button>
          </div>
        </article>

        <article class="card">
          <h3>移动至新货架</h3>
          <form id="moveBoxShelfForm" class="form-grid overseas-form">
            <label>
              箱号
              <select id="moveShelfBoxId" required>
                <option value="">请选择箱号</option>
              </select>
            </label>
            <label>
              新货架号
              <select id="moveShelfTargetId" required>
                <option value="">请选择目标货架号</option>
              </select>
            </label>
            <button type="submit">移动至新货架</button>
          </form>
        </article>

        <article class="card">
          <h3>移动至新箱号</h3>
          <form id="moveBoxCodeForm" class="form-grid overseas-form">
            <label>
              当前箱号
              <select id="moveCodeBoxId" required>
                <option value="">请选择箱号</option>
              </select>
            </label>
            <label>
              新箱号（B-）
              <input
                id="moveCodeNewDigits"
                inputmode="numeric"
                maxlength="4"
                placeholder="4位数字"
                required
              />
            </label>
            <button type="submit">移动至新箱号</button>
          </form>
        </article>
      </section>

      <section class="panel" id="batchInbound">
        <div class="panel-head">
          <h2>批量入库</h2>
          <button id="refreshBatchInbound" class="ghost">刷新</button>
        </div>

        <div class="batch-inbound-layout">
          <article class="card">
            <h3>第一步：输入批号并采集箱号</h3>
            <form id="collectBatchInboundForm" class="form-grid batch-collect-form">
              <label>
                批号
                <input
                  id="batchCollectBatchNo"
                  type="text"
                  inputmode="numeric"
                  maxlength="20"
                  placeholder="例如：1"
                  autocomplete="off"
                  required
                />
              </label>
              <label>
                采集总箱数
                <input
                  id="batchCollectBoxCount"
                  type="text"
                  inputmode="numeric"
                  placeholder="例如：20"
                  autocomplete="off"
                  required
                />
              </label>
              <button type="submit" class="batch-collect-submit">采集</button>
            </form>
            <p id="batchCollectHint" class="batch-hint muted">点击采集后系统会分配连续可用箱号范围。</p>
          </article>

          <article class="card">
            <h3>第二步：上传批量入库文档</h3>
            <form id="uploadBatchInboundForm" class="form-grid batch-upload-form">
              <label>
                选择批量入库单
                <select id="batchUploadOrderId" required>
                  <option value="">请选择入库单</option>
                </select>
              </label>
              <label>
                Excel 文件
                <input id="batchInboundFile" type="file" accept=".xlsx,.xls,.csv" required />
              </label>
              <button type="submit">上传并校验箱号</button>
            </form>
          </article>
        </div>

        <div class="card">
          <h3>批量入库单列表</h3>
          <table>
            <thead>
              <tr>
                <th>单号</th>
                <th>状态</th>
                <th>采集箱号范围</th>
                <th>国内单号</th>
                <th>海运单号</th>
                <th>明细进度</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="batchInboundBody"></tbody>
          </table>
        </div>

      </section>

      <section class="panel" id="fbaReplenishment">
        <div class="panel-head">
          <h2>FBA补货申请一览</h2>
          <div class="panel-tools">
            <button id="fbaBatchOutboundBtn" type="button">出库</button>
            <button id="refreshFbaReplenishment" class="ghost">刷新</button>
          </div>
        </div>
        <table>
          <thead>
            <tr>
              <th><input id="fbaSelectAll" type="checkbox" /></th>
              <th>申请单号</th>
              <th>状态</th>
              <th>SKU</th>
              <th>型号</th>
              <th>说明1</th>
              <th>箱号</th>
              <th>货架号</th>
              <th>申请数量</th>
              <th>实际数量</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody id="fbaReplenishmentBody"></tbody>
        </table>
      </section>

      <section class="panel" id="overview">
        <div class="panel-head">
          <h2>系统状态</h2>
          <button type="button" id="logoutBtn" class="ghost">退出登录</button>
        </div>

        <div class="cards">
          <article class="card">
            <h3>当前用户</h3>
            <pre id="meCard">-</pre>
          </article>
          <article class="card">
            <h3>快速统计</h3>
            <ul class="stats">
              <li><span>员工数</span><strong id="statUsers">-</strong></li>
              <li><span>SKU 数</span><strong id="statSkus">-</strong></li>
              <li><span>货架数</span><strong id="statShelves">-</strong></li>
              <li><span>箱号数</span><strong id="statBoxes">-</strong></li>
              <li><span>待确认入库单</span><strong id="statInboundDraft">-</strong></li>
            </ul>
          </article>
        </div>
      </section>

      <section class="panel" id="users">
        <div class="panel-head">
          <h2>员工管理</h2>
          <button id="refreshUsers" class="ghost">刷新</button>
        </div>
        <form id="createUserForm" class="form-grid compact">
          <label>用户名<input id="newUsername" required /></label>
          <label>密码<input id="newPassword" type="text" required /></label>
          <label>角色
            <select id="newRole">
              <option value="employee">员工</option>
              <option value="admin">管理者</option>
            </select>
          </label>
          <button type="submit">新增员工</button>
        </form>
        <table>
          <thead><tr><th>用户名</th><th>密码（明文）</th><th>角色</th><th>状态</th><th>更新时间</th></tr></thead>
          <tbody id="usersBody"></tbody>
        </table>
      </section>

      <section class="panel" id="shelves">
        <div class="panel-head">
          <h2>货架管理</h2>
          <button id="refreshShelves" class="ghost">刷新</button>
        </div>
        <form id="createShelfForm" class="form-grid compact">
          <label>货架号（S-）
            <input id="newShelfCodeDigits" inputmode="numeric" maxlength="3" placeholder="3位数字" required />
          </label>
          <label>名称<input id="newShelfName" /></label>
          <button type="submit">新增货架</button>
        </form>
        <table>
          <thead><tr><th>货架号</th><th>名称</th><th>状态</th></tr></thead>
          <tbody id="shelvesBody"></tbody>
        </table>
      </section>

      <section class="panel" id="boxes">
        <div class="panel-head">
          <h2>箱号管理</h2>
          <button id="refreshBoxes" class="ghost">刷新</button>
        </div>
        <form id="createBoxForm" class="form-grid compact">
          <label>箱号（B-）
            <input id="newBoxCodeDigits" inputmode="numeric" maxlength="4" placeholder="4位数字" required />
          </label>
          <label>货架号
            <select id="newBoxShelfId" required></select>
          </label>
          <button type="submit">新增箱号</button>
        </form>
        <table>
          <thead><tr><th>箱号</th><th>货架号</th><th>状态</th></tr></thead>
          <tbody id="boxesBody"></tbody>
        </table>
      </section>

      <section class="panel" id="audit">
        <div class="panel-head">
          <h2>操作日志</h2>
          <button id="refreshAudit" class="ghost">刷新</button>
        </div>
        <table>
          <thead><tr><th>时间</th><th>实体</th><th>动作</th><th>事件</th><th>操作人</th><th>请求ID</th></tr></thead>
          <tbody id="auditBody"></tbody>
        </table>
      </section>
    </section>
  </main>

  <div id="createSkuModal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <h3>新增产品</h3>
        <button type="button" class="ghost" data-action="closeCreateSkuModal">关闭</button>
      </div>
      <form id="createSkuModalForm" class="form-grid modal-grid">
        <label>型号<input id="modalNewModel" /></label>
        <label>SKU<input id="modalNewSku" required /></label>
        <label>说明1<input id="modalNewDesc1" /></label>
        <label>erpSKU<input id="modalNewErpSku" /></label>
        <label>说明2<input id="modalNewDesc2" /></label>
        <label>ASIN<input id="modalNewAsin" /></label>
        <label>备注<input id="modalNewRemark" /></label>
        <label>FNSKU<input id="modalNewFnsku" /></label>
        <label>所属亚马逊店铺<input id="modalNewShop" /></label>
        <label class="create-sku-left-col">箱号
          <input
            id="modalNewSkuBoxCode"
            list="modalNewSkuBoxCodeList"
            placeholder="请选择已有箱号或者新增箱号"
            inputmode="numeric"
            required
          />
          <datalist id="modalNewSkuBoxCodeList"></datalist>
        </label>
        <div class="create-sku-box-action create-sku-right-col">
          <button type="button" id="openCreateBoxFromSkuModal" class="small-btn">新增箱号</button>
        </div>
        <label class="create-sku-left-col">入库数<input id="modalNewSkuQty" type="number" min="1" value="1" required /></label>
        <div class="modal-actions">
          <button type="submit">确认新增</button>
          <button type="button" class="ghost" data-action="closeCreateSkuModal">取消</button>
        </div>
      </form>
    </div>
  </div>

  <div id="editSkuModal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <h3>编辑产品</h3>
        <button type="button" class="ghost" data-action="closeEditSkuModal">关闭</button>
      </div>
      <form id="editSkuForm" class="form-grid modal-grid">
        <input id="editSkuId" type="hidden" />
        <label>型号<input id="editModel" /></label>
        <label>SKU<input id="editSku" readonly /></label>
        <label>说明1<input id="editDesc1" /></label>
        <label>erpSKU<input id="editErpSku" /></label>
        <label>说明2<input id="editDesc2" /></label>
        <label>ASIN<input id="editAsin" /></label>
        <label>备注<input id="editRemark" /></label>
        <label>FNSKU<input id="editFnsku" /></label>
        <label>所属亚马逊店铺<input id="editShop" /></label>
        <div class="modal-actions">
          <button type="submit">保存</button>
          <button type="button" class="ghost" data-action="closeEditSkuModal">取消</button>
        </div>
      </form>
    </div>
  </div>

  <div id="myAuditModal" class="modal hidden">
    <div class="modal-card modal-wide">
      <div class="modal-head">
        <h3>我的操作日志</h3>
        <button type="button" class="ghost" data-action="closeMyAuditModal">关闭</button>
      </div>
      <div class="panel-head">
        <div></div>
        <button id="refreshMyAudit" class="ghost" type="button">刷新</button>
      </div>
      <table>
        <thead><tr><th>时间</th><th>实体</th><th>动作</th><th>事件</th><th>请求ID</th></tr></thead>
        <tbody id="myAuditBody"></tbody>
      </table>
    </div>
  </div>

  <div id="profileModal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <h3>个人信息设置</h3>
        <button type="button" class="ghost" data-action="closeProfileModal">关闭</button>
      </div>
      <form id="profileForm" class="form-grid modal-grid">
        <label>用户名<input id="profileUsername" readonly /></label>
        <label>角色<input id="profileRole" readonly /></label>
        <label>当前密码<input id="profileCurrentPassword" type="password" required /></label>
        <label>新密码<input id="profileNewPassword" type="password" minlength="6" required /></label>
        <div class="modal-actions">
          <button type="submit">保存</button>
          <button type="button" class="ghost" data-action="closeProfileModal">取消</button>
        </div>
      </form>
    </div>
  </div>

  <div id="adjustModal" class="modal hidden">
    <div class="modal-card modal-adjust">
      <div class="modal-head">
        <h3 id="adjustModalTitle">库存操作</h3>
        <button type="button" class="ghost" data-action="closeAdjustModal">关闭</button>
      </div>
      <form id="adjustForm" class="form-grid modal-grid adjust-single-col">
        <input id="adjustSkuId" type="hidden" />
        <input id="adjustDirection" type="hidden" />
        <label>箱号
          <div class="adjust-box-row">
            <input
              id="adjustBoxCode"
              list="adjustBoxCodeList"
              required
              autocomplete="off"
              placeholder="输入数字或选择已有箱号"
            />
            <datalist id="adjustBoxCodeList"></datalist>
            <button id="openCreateBoxFromAdjust" type="button" class="ghost">新增箱号</button>
          </div>
          <span id="adjustBoxHint" class="field-hint hidden">未找到匹配箱号，请点击右侧新增箱号</span>
        </label>
        <label>数量<input id="adjustQty" type="number" min="1" step="1" required /></label>
        <label>备注<input id="adjustReason" maxlength="10" /></label>
        <div class="modal-actions">
          <button id="adjustSubmitBtn" type="submit">提交</button>
          <button type="button" class="ghost" data-action="closeAdjustModal">取消</button>
        </div>
      </form>
    </div>
  </div>

  <div id="createBoxFromSkuModal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <h3>新增箱号</h3>
        <button type="button" class="ghost" data-action="closeCreateBoxFromSkuModal">关闭</button>
      </div>
      <form id="createBoxFromSkuForm" class="form-grid modal-grid">
        <label>箱号（B-）
          <input id="modalNewBoxCodeDigits" inputmode="numeric" maxlength="4" placeholder="4位数字" required />
        </label>
        <label>货架号
          <select id="modalNewBoxShelfId" required></select>
        </label>
        <div class="modal-actions">
          <button type="submit">确认新增箱号</button>
          <button type="button" class="ghost" data-action="closeCreateBoxFromSkuModal">取消</button>
        </div>
      </form>
    </div>
  </div>

  <div id="createShelfFromInventoryModal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <h3>新增货架</h3>
        <button type="button" class="ghost" data-action="closeCreateShelfFromInventoryModal">关闭</button>
      </div>
      <form id="createShelfFromInventoryForm" class="form-grid modal-grid">
        <label>货架号（S-）
          <input id="modalNewShelfCodeDigits" inputmode="numeric" maxlength="3" placeholder="3位数字" required />
        </label>
        <label>名称<input id="modalNewShelfName" /></label>
        <div class="modal-actions">
          <button type="submit">确认新增货架</button>
          <button type="button" class="ghost" data-action="closeCreateShelfFromInventoryModal">取消</button>
        </div>
      </form>
    </div>
  </div>

  <div id="deleteConfirmModal" class="modal hidden">
    <div class="modal-card modal-confirm">
      <div class="modal-head">
        <h3 class="confirm-title"><span class="confirm-icon">!</span>确认删除</h3>
        <button type="button" class="ghost" data-action="closeDeleteConfirmModal">关闭</button>
      </div>
      <p id="deleteConfirmMessage" class="confirm-message">确认删除当前批量入库单？</p>
      <div class="modal-actions">
        <button id="deleteConfirmOkBtn" type="button" class="danger-solid">确认删除</button>
        <button id="deleteConfirmCancelBtn" type="button" class="ghost">取消</button>
      </div>
    </div>
  </div>

  <div id="errorModal" class="modal hidden">
    <div class="modal-card modal-error">
      <div class="modal-head">
        <h3 class="confirm-title"><span class="confirm-icon">!</span>错误</h3>
        <button type="button" class="ghost" data-action="closeErrorModal">关闭</button>
      </div>
      <p id="errorModalMessage" class="confirm-message">发生错误</p>
      <div class="modal-actions">
        <button id="errorModalCloseBtn" type="button" class="danger-solid">我知道了</button>
      </div>
    </div>
  </div>

  <div id="batchInboundDetailModal" class="modal hidden">
    <div class="modal-card modal-wide batch-detail-modal-card">
      <div class="modal-head">
        <h3>确认入库</h3>
        <button type="button" class="ghost" data-action="closeBatchInboundDetailModal">关闭</button>
      </div>
      <div id="batchInboundDetail" class="batch-detail-empty muted">请先选择批量入库单。</div>
    </div>
  </div>

  <div id="fbaOutboundModal" class="modal hidden">
    <div class="modal-card modal-adjust">
      <div class="modal-head">
        <h3>FBA补货出库</h3>
        <button type="button" class="ghost" data-action="closeFbaOutboundModal">关闭</button>
      </div>
      <form id="fbaOutboundForm" class="form-grid modal-grid adjust-single-col">
        <label>快递号<input id="fbaOutboundExpressNo" maxlength="128" required /></label>
        <div class="modal-actions">
          <button id="fbaOutboundSubmitBtn" type="submit">确认出库</button>
          <button type="button" class="ghost" data-action="closeFbaOutboundModal">取消</button>
        </div>
      </form>
    </div>
  </div>

  <div id="toast" class="toast hidden"></div>
  <script type="module" src="/app.js"></script>
</body>
</html>
